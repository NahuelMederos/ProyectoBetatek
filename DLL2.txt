Create database betatek;

use betatek;

CREATE TABLE PERSONA(
CI VARCHAR(25) PRIMARY KEY,
NOMBRE VARCHAR(20) NOT NULL,
APELLIDO VARCHAR(20) NOT NULL,
EDAD VARCHAR(3) NOT NULL,
MAIL VARCHAR(40) UNIQUE NOT NULL,
ACTIVO BOOLEAN DEFAULT 1
);


CREATE TABLE ADMINISTRATIVO (
NOMBREUSUARIO VARCHAR(30),
NOMBRE VARCHAR(25) NOT NULL,
APELLIDO VARCHAR(25) NOT NULL,
CEDULA VARCHAR(8) NOT NULL UNIQUE,
PRIMARY KEY(NOMBREUSUARIO),
ACTIVO BOOLEAN DEFAULT 1
)
;

CREATE TABLE MEDICO(
NOMBREUSUARIO VARCHAR(30),
NOMBRE VARCHAR(25) NOT NULL,
APELLIDO VARCHAR(25) NOT NULL,
CEDULA VARCHAR(8) NOT NULL UNIQUE,
PRIMARY KEY(NOMBREUSUARIO),
ACTIVO BOOLEAN DEFAULT 1
);

CREATE TABLE SINTOMA(
IDSINTOMA INTEGER AUTO_INCREMENT PRIMARY KEY,
NOMBRE VARCHAR(30) NOT NULL UNIQUE,
ACTIVO BOOLEAN DEFAULT 1
);

CREATE TABLE PATOLOGIA(
IDPATOLOGIA INTEGER AUTO_INCREMENT PRIMARY KEY,
NOMBRE VARCHAR(30) NOT NULL UNIQUE,
PRIORIDAD VARCHAR(5) NOT NULL CHECK (PRIORIDAD IN ('BAJA','MEDIA','ALTA')), 
ACTIVO BOOLEAN DEFAULT 1
);

CREATE TABLE PATOLOGIA_SINTOMAS(
IDPATOLOGIA_PAT INTEGER NOT NULL,
SINTOMA INTEGER NOT NULL,
FOREIGN KEY (SINTOMA) REFERENCES SINTOMA (IDSINTOMA),
FOREIGN KEY (IDPATOLOGIA_PAT) REFERENCES PATOLOGIA (IDPATOLOGIA),
PRIMARY KEY (IDPATOLOGIA_PAT,SINTOMA)
);


CREATE TABLE DIAGNOSTICO(
IDDIAGNOSTICO INTEGER AUTO_INCREMENT PRIMARY KEY,
PRIORIDAD VARCHAR(5) CHECK (PRIORIDAD IN ('BAJA','MEDIA','ALTA')),
INFORMACION TEXT,
SOLICITACHAT BOOLEAN
);

CREATE TABLE PATOLOGIAS(
IDDIAGNOSTICO INTEGER,
IDPATOLOGIA INTEGER,
FOREIGN KEY (IDDIAGNOSTICO) REFERENCES DIAGNOSTICO (IDDIAGNOSTICO),
FOREIGN KEY (IDPATOLOGIA) REFERENCES PATOLOGIA (IDPATOLOGIA),
PRIMARY KEY (IDDIAGNOSTICO,IDPATOLOGIA)
);


CREATE TABLE TIENE(
CIPERSONA VARCHAR(25),
IDSINTOMA INTEGER,
FOREIGN KEY(CIPERSONA) REFERENCES PERSONA(CI),
FOREIGN KEY(IDSINTOMA) REFERENCES SINTOMA(IDSINTOMA),
PRIMARY KEY(CIPERSONA,IDSINTOMA)
);

CREATE TABLE RECIBE(
IDDIAGNOSTICO INTEGER,
NOMBREMEDICO VARCHAR(30),
ESTADOSESION BOOLEAN DEFAULT 1,
FOREIGN KEY(IDDIAGNOSTICO) REFERENCES DIAGNOSTICO(IDDIAGNOSTICO),
FOREIGN KEY(NOMBREMEDICO) REFERENCES MEDICO(NOMBREUSUARIO),
PRIMARY KEY(IDDIAGNOSTICO,NOMBREMEDICO)
);

CREATE TABLE GESTIONA(
NOMBREADMIN VARCHAR(30),
IDSINTOMA INTEGER NOT NULL,
IDPATOLOGIA INTEGER NOT NULL,
FOREIGN KEY(NOMBREADMIN) REFERENCES ADMINISTRATIVO(NOMBREUSUARIO),
FOREIGN KEY(IDSINTOMA) REFERENCES SINTOMA(IDSINTOMA),
FOREIGN KEY(IDPATOLOGIA) REFERENCES PATOLOGIA(IDPATOLOGIA),
PRIMARY KEY(NOMBREADMIN,IDSINTOMA,IDPATOLOGIA)
);

CREATE TABLE GENERA(
CIPERSONA VARCHAR(25),
IDDIAGNOSTICO INTEGER,
IDSINTOMA INTEGER,
FECHAHORA TIMESTAMP NOT NULL,
FOREIGN KEY(CIPERSONA) REFERENCES PERSONA(CI),
FOREIGN KEY(IDDIAGNOSTICO) REFERENCES DIAGNOSTICO(IDDIAGNOSTICO),
FOREIGN KEY(IDSINTOMA) REFERENCES SINTOMA(IDSINTOMA),
PRIMARY KEY(CIPERSONA,IDDIAGNOSTICO,IDSINTOMA)
);

CREATE TABLE CHATEA(
IDMENSAJE INTEGER AUTO_INCREMENT PRIMARY KEY,
SESION VARCHAR(10) NOT NULL,
DE VARCHAR(20) NOT NULL,
PARA VARCHAR(20) NOT NULL,
TEXTO TEXT,
FECHAHORA TIMESTAMP NOT NULL,
LEIDO BOOLEAN NOT NULL DEFAULT 0
);

INSERT INTO MEDICO VALUES('MEDICO','Solicitudes','CHAT','1',DEFAULT);

CREATE USER '11111111'@'localhost' IDENTIFIED BY '123';
GRANT INSERT,UPDATE,SELECT ON betatek.Chatea TO '11111111'@'localhost';
GRANT UPDATE (Nombre,Apellido,Edad,Mail),SELECT ON betatek.Persona to '11111111'@'localhost';
GRANT SELECT ON betatek.Medico TO '11111111'@'localhost';
GRANT INSERT ON betatek.Genera TO '11111111'@'localhost';
Grant Insert On betatek.Patologias to '11111111'@'localhost';
GRANT INSERT,SELECT,UPDATE ON betatek.Recibe TO '11111111'@'localhost';
GRANT SELECT,INSERT ON betatek.Diagnostico TO '11111111'@'localhost';
GRANT SELECT ON betatek.Sintoma TO '11111111'@'localhost';
GRANT SELECT ON betatek.Patologia TO '11111111'@'localhost';
GRANT SELECT ON betatek.Patologia_Sintomas TO '11111111'@'localhost';
GRANT INSERT ON betatek.Tiene TO '11111111'@'localhost';
INSERT INTO PERSONA VALUES('11111111','Ejemplo','Paciente',25,'mail@gmail.com',DEFAULT);

CREATE USER 'EjemploMedico'@'localhost' IDENTIFIED BY '123';
GRANT SELECT on betatek.Medico TO 'EjemploMedico'@'localhost';
GRANT SELECT,UPDATE on betatek.Recibe TO 'EjemploMedico'@'localhost';
GRANT SELECT on betatek.Genera TO 'EjemploMedico'@'localhost';
GRANT SELECT on betatek.Diagnostico TO 'EjemploMedico'@'localhost';
GRANT INSERT,UPDATE,SELECT ON betatek.Chatea TO 'EjemploMedico'@'localhost';
GRANT SELECT ON betatek.PERSONA TO 'EjemploMedico'@'localhost';
INSERT INTO MEDICO VALUES('EjemploMedico','Ejemplo','Medico','22222222',DEFAULT);

CREATE USER 'EjemploGestor'@'localhost' IDENTIFIED BY '123';
GRANT ALL PRIVILEGES ON betatek.* TO 'EjemploGestor'@'localhost' WITH GRANT OPTION;
GRANT SELECT ON MYSQL.USER TO 'EjemploGestor'@'localhost';
GRANT CREATE USER ON *.* TO 'EjemploGestor'@'localhost' WITH GRANT OPTION;
INSERT INTO ADMINISTRATIVO VALUES('EjemploGestor','Ejemplo','Gestor','33333333',DEFAULT);

INSERT INTO SINTOMA VALUES(1,'Cansancio',default);
INSERT INTO SINTOMA VALUES(2,'Diarrea',default);
INSERT INTO SINTOMA VALUES(3,'Dolor de estomago',default);
INSERT INTO SINTOMA VALUES(4,'Fiebre',default);
INSERT INTO SINTOMA VALUES(5,'Tos',default);
INSERT INTO SINTOMA VALUES(6,'Dolor de cabeza',default);

INSERT INTO PATOLOGIA VALUES(1,'Covid','ALTA',default);
INSERT INTO PATOLOGIA VALUES(2,'Gripe','MEDIA',default);
INSERT INTO PATOLOGIA VALUES(3,'Gastroenteritis','BAJA',default);

INSERT INTO PATOLOGIA_SINTOMAS VALUES(1,1);
INSERT INTO PATOLOGIA_SINTOMAS VALUES(1,4);
INSERT INTO PATOLOGIA_SINTOMAS VALUES(1,5);
INSERT INTO PATOLOGIA_SINTOMAS VALUES(2,4);
INSERT INTO PATOLOGIA_SINTOMAS VALUES(2,5);
INSERT INTO PATOLOGIA_SINTOMAS VALUES(2,6);
INSERT INTO PATOLOGIA_SINTOMAS VALUES(3,3);
INSERT INTO PATOLOGIA_SINTOMAS VALUES(3,2);

INSERT INTO DIAGNOSTICO VALUES(1,'Alta','El paciente 11111111 solicito un diagnostico presentando los siguientes sintomas: Cansancio, Diarrea, Dolor de estomago, Fiebre, Tos, Dolor de cabeza. El Diagnostico automatico le dio como resultado: "Las posibles patologias segun los sintomas seleccionados son: Covid, Gripe, Gastroenteritis.',1);
INSERT INTO DIAGNOSTICO VALUES(2,'Alta','El paciente 11111111 solicito un diagnostico presentando los siguientes sintomas: Cansancio, Diarrea, Dolor de estomago, Fiebre, Tos, Dolor de cabeza. El Diagnostico automatico le dio como resultado: "Las posibles patologias segun los sintomas seleccionados son: Covid, Gripe, Gastroenteritis.',1);

INSERT INTO PATOLOGIAS VALUES(1,1);
INSERT INTO PATOLOGIAS VALUES(2,1);
INSERT INTO PATOLOGIAS VALUES(1,2);
INSERT INTO PATOLOGIAS VALUES(2,2);
INSERT INTO PATOLOGIAS VALUES(1,3);
INSERT INTO PATOLOGIAS VALUES(2,3);

INSERT INTO TIENE VALUES('11111111',1);
INSERT INTO TIENE VALUES('11111111',2);
INSERT INTO TIENE VALUES('11111111',3);
INSERT INTO TIENE VALUES('11111111',4);
INSERT INTO TIENE VALUES('11111111',5);
INSERT INTO TIENE VALUES('11111111',6);

INSERT INTO GENERA VALUES('11111111',1,1,'2020-11-05 07:51:42');
INSERT INTO GENERA VALUES('11111111',1,2,'2020-11-05 07:51:42');
INSERT INTO GENERA VALUES('11111111',1,3,'2020-11-05 07:51:42');
INSERT INTO GENERA VALUES('11111111',1,4,'2020-11-05 07:51:42');
INSERT INTO GENERA VALUES('11111111',1,5,'2020-11-05 07:51:42');
INSERT INTO GENERA VALUES('11111111',1,6,'2020-11-05 07:51:42');
INSERT INTO GENERA VALUES('11111111',2,1,'2020-11-05 07:54:17');
INSERT INTO GENERA VALUES('11111111',2,2,'2020-11-05 07:54:17');
INSERT INTO GENERA VALUES('11111111',2,3,'2020-11-05 07:54:17');
INSERT INTO GENERA VALUES('11111111',2,4,'2020-11-05 07:54:17');
INSERT INTO GENERA VALUES('11111111',2,5,'2020-11-05 07:54:17');
INSERT INTO GENERA VALUES('11111111',2,6,'2020-11-05 07:54:17');


INSERT INTO CHATEA VALUES(1,1,'11111111','Medico','Hola','2020-11-05 07:52:43',1);
INSERT INTO CHATEA VALUES(2,1,'11111111','Medico','Este es un mensaje de prueba','2020-11-05 07:52:43',1);
INSERT INTO CHATEA VALUES(3,1,'EjemploMedico','11111111','Hola','2020-11-05 07:52:46',1);
INSERT INTO CHATEA VALUES(4,1,'EjemploMedico','11111111','Este tambien','2020-11-05 07:52:52',1);
INSERT INTO CHATEA VALUES(5,1,'11111111','EjemploMedico','Fin del chat','2020-11-05 07:52:58',1);
INSERT INTO CHATEA VALUES(6,2,'11111111','Medico','Hola','2020-11-05 07:54:23',0);

INSERT INTO RECIBE VALUES(1,'EjemploMedico',0);
INSERT INTO RECIBE VALUES(2,'Medico',1);

INSERT INTO PERSONA VALUES('nahuel.mederos','Nahuel','Mederos',22,'nahuelmederos1@gmail.com',1);
INSERT INTO PERSONA VALUES('guillermo.orgoroso','Guillermo','Orgoroso',26,'guille.bozza@gmail.com',1);

INSERT INTO MEDICO VALUES('nahuel.mederos','Nahuel','Mederos','50752552',1);
INSERT INTO MEDICO VALUES('guillermo.orgoroso','Guille','Orgoroso','51467958',1);

INSERT INTO ADMINISTRATIVO VALUES('nahuel.mederos','Nahuel','Mederos','50752552',1);
INSERT INTO ADMINISTRATIVO VALUES('guillermo.orgoroso','Guille','Orgoroso','51467958',1);
